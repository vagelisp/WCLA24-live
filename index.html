<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WordCamp Larissa 2024</title>
  <style>
    /* Ensure the body and html elements take up the full viewport */
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }

    /* Wrapper to contain and position the iframe */
    #iframeWrapper {
      position: relative;
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

    /* Full-size iframe with a 200px offset from both the top and bottom */
    iframe {
      position: absolute;
      top: -200px; /* Hide top 200px of iframe content */
      left: 0;
      width: 100%;
      height: calc(100% + 400px); /* Extend height to cover both hidden parts (top + bottom). This ensures that any menus, cookie bars, or similar elements from the remote URLs are hidden from view in our version. */
      border: none;
      opacity: 1;
      transition: opacity 1s ease-in-out; /* Smooth fade effect for iframe transitions */
    }

    /* Progress bar at the bottom of the screen */
    #progressBar {
      position: fixed;
      bottom: 0;
      left: 0;
      height: 10px; /* Thickness of the progress bar */
      width: 0; /* Initial width set to 0% */
      background-color: #4b192d; /* Progress bar color */
      transition: width linear; /* Smooth progress bar expansion */
    }
  </style>
</head>
<body>

<!-- Wrapper to contain the dynamic iframe -->
<div id="iframeWrapper">
  <iframe id="dynamicIframe"></iframe>
</div>

<!-- Progress bar element to indicate time left before URL change -->
<div id="progressBar"></div>

<script>
  /**
   * Fetches the list of URLs from an external JSON file.
   * @returns {Promise<string[]>} A promise that resolves to an array of URLs.
   */
  async function fetchUrls() {
    try {
      const response = await fetch('live-urls.json'); // Fetch the JSON file
      if (!response.ok) throw new Error('Failed to fetch URLs'); // Check response status
      const data = await response.json(); // Parse the JSON data
      if (!Array.isArray(data.urls) || data.urls.length === 0) {
        throw new Error('Invalid URL data'); // Ensure the URLs are valid
      }
      return data.urls;
    } catch (error) {
      console.error('Error fetching URLs:', error.message); // Log errors
      return []; // Return an empty array as fallback
    }
  }

  /**
   * Starts the iframe rotation by cycling through URLs every 15 seconds.
   * Handles progress bar animation and iframe transitions.
   */
  async function startRotation() {
    const urls = await fetchUrls(); // Get the list of URLs
    if (urls.length === 0) {
      // Show error message if no URLs are available
      document.body.innerHTML = '<p style="color:red;text-align:center;">No URLs available. Please try again later.</p>';
      return;
    }

    const iframe = document.getElementById('dynamicIframe');
    const progressBar = document.getElementById('progressBar');
    let currentIndex = 0; // Track the current URL index

    // Define time constants for better readability
    const FADE_DURATION = 1500; // 1 second for fade transitions
    const INTERVAL = 21500; // 15 seconds per URL

    /**
     * Resets and starts the progress bar animation for the current interval.
     */
    function resetProgressBar() {
      progressBar.style.transition = 'none'; // Temporarily disable transition
      progressBar.style.width = '0'; // Reset width to 0%

      // Use requestAnimationFrame to ensure CSS changes are rendered smoothly
      requestAnimationFrame(() => {
        setTimeout(() => {
          progressBar.style.transition = `width ${INTERVAL / 1000}s linear`; // Set bar expansion timing
          progressBar.style.width = '100%'; // Expand the bar to full width
        }, 50); // Delay slightly to allow reset to take effect
      });
    }

    /**
     * Loads the next URL into the iframe and manages transition effects.
     */
    function loadNextUrl() {
      iframe.style.opacity = 0; // Fade out current iframe content
      setTimeout(() => {
        iframe.src = urls[currentIndex]; // Load the next URL
        currentIndex = (currentIndex + 1) % urls.length; // Loop back to the first URL after the last

        iframe.onload = () => {
          iframe.style.opacity = 1; // Fade-in after the new URL loads
        };

        resetProgressBar(); // Start the progress bar animation

        // Schedule the next URL load after the interval
        setTimeout(loadNextUrl, INTERVAL);
      }, FADE_DURATION); // Wait for fade-out to complete before switching
    }

    // Start the initial load and animation cycle
    resetProgressBar();
    loadNextUrl();
  }

  // Start the rotation process when the page loads
  startRotation();
</script>

</body>
</html>
